AWSTemplateFormatVersion: 2010-09-09
Description: Cloudformation template for HDVA
Metadata:
  Frontend:
    Description: Static build is deployed to public S3 Bucket
Parameters:
  InstanceTypeParameter:
    Type: String
    Default: t2.micro
    AllowedValues:
      - t2.micro
      - m1.small
      - m1.large
    Description: 'Enter t2.micro, m1.small, or m1.large. Default is t2.micro.'

Resources:    
  FrontendBucket:
    Type: 'AWS::S3::Bucket'
    Properties:
      AccessControl: PublicRead
      CorsConfiguration:
        CorsRules:
          - AllowedHeaders: 
              - "*"
            AllowedMethods: 
              - "GET"
              - "POST"
            AllowedOrigins: 
              - "*"
            ExposedHeaders: 
              - "Date"
            MaxAge: '3600'
      LoggingConfiguration:
        LogFilePrefix: logs/
        DestinationBucketName: !Ref LogBucket
      WebsiteConfiguration:
        IndexDocument: index.html
        ErrorDocument: error.html
    DeletionPolicy: Retain
  LogBucket:
    Type: 'AWS::S3::Bucket'
    Properties:
      AccessControl: LogDeliveryWrite
      LifecycleConfiguration:
        Rules:
          - AbortIncompleteMultipartUpload:
              DaysAfterInitiation: 7
            Status: Enabled
            Transitions:
              - StorageClass: GLACIER
                TransitionInDays: 30
      PublicAccessBlockConfiguration:
          BlockPublicAcls: true
          BlockPublicPolicy: true
          IgnorePublicAcls: true
          RestrictPublicBuckets: true
Outputs:
  LogBucketArn:
    Value: !Ref LogBucket
  FrontendBucketArn:
    Value: !Ref FrontendBucket
    Description: S3 Bucket for object storage